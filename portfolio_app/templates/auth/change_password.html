{% extends 'base.html' %}

{% block title %}Change Password â€” Investment Performance{% endblock %}

{% block extra_css %}<style>
    .field-wrap { position: relative; }
    .field-wrap .fi { position: absolute; left: 0.8rem; top: 50%; transform: translateY(-50%); color: var(--text-tertiary); pointer-events: none; }
    .field-wrap input { padding-left: 2.25rem; }
</style>{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-5">
        <div class="card p-4 p-md-5" style="border-radius: var(--border-radius-lg); box-shadow: var(--shadow-xl);">

            <div class="mb-4">
                <h2 class="mb-1" style="font-size:1.4rem; font-weight:500;">
                    <i class="bi bi-key me-2 text-primary"></i>Change Password
                </h2>
                <p class="text-muted mb-0" style="font-size:0.875rem;">
                    Logged in as <strong>{{ current_user.username }}</strong>
                </p>
            </div>

            {% if form_errors.get('__all__') %}
                <div class="alert alert-danger flash-alert mb-3">
                    <i class="bi bi-exclamation-circle me-2"></i>{{ form_errors['__all__'] }}
                </div>
            {% endif %}

            <form method="post" action="{{ url_for('auth.change_password') }}" novalidate>
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <!-- Current password -->
                <div class="mb-3">
                    <label for="current_password" class="form-label">Current Password</label>
                    <div class="field-wrap">
                        <i class="bi bi-lock fi"></i>
                        <input type="password" id="current_password" name="current_password"
                               autocomplete="current-password"
                               class="form-control {% if form_errors.get('current_password') %}is-invalid{% endif %}"
                               placeholder="Enter your current password" required>
                    </div>
                    {% if form_errors.get('current_password') %}
                        <div class="invalid-feedback d-block mt-1">{{ form_errors['current_password'] }}</div>
                    {% endif %}
                </div>

                <!-- New password -->
                <div class="mb-3">
                    <label for="new_password" class="form-label">New Password</label>
                    <div class="field-wrap">
                        <i class="bi bi-lock-fill fi"></i>
                        <input type="password" id="new_password" name="new_password"
                               autocomplete="new-password"
                               class="form-control {% if form_errors.get('new_password') %}is-invalid{% endif %}"
                               placeholder="Min. 8 characters" required>
                    </div>
                    {% if form_errors.get('new_password') %}
                        <div class="invalid-feedback d-block mt-1">{{ form_errors['new_password'] }}</div>
                    {% endif %}
                </div>

                <!-- Confirm new password -->
                <div class="mb-4">
                    <label for="confirm_new_password" class="form-label">Confirm New Password</label>
                    <div class="field-wrap">
                        <i class="bi bi-shield-check fi"></i>
                        <input type="password" id="confirm_new_password" name="confirm_new_password"
                               autocomplete="new-password"
                               class="form-control {% if form_errors.get('confirm_new_password') %}is-invalid{% endif %}"
                               placeholder="Re-enter new password" required>
                    </div>
                    {% if form_errors.get('confirm_new_password') %}
                        <div class="invalid-feedback d-block mt-1">{{ form_errors['confirm_new_password'] }}</div>
                    {% endif %}
                </div>

                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary flex-grow-1">
                        Update Password
                    </button>
                    <a href="{{ url_for('dashboard.index') }}" class="btn btn-outline-secondary">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
